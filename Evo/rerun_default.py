import os
import pickle
import numpy as np
from revolve2.Evo.utils import evaluate2
from revolve2.examples.evaluate_single_robot import modified
import torch
import seaborn as sns
import matplotlib.pyplot as plt

torch.set_printoptions(precision=30)
file = open('brain', 'rb')
cpg_network_structure = pickle.load(file)
path = 'Results_Generalists'
# path = 'Results/Results_Specialist'
type = 'generalist'
# type = 'xbest'

if __name__ == "__main__":
    files = os.listdir(f'{path}/{type}')
    overall = []
    for file in files:
        if file.endswith('pt'):
            torch.set_printoptions(precision=30)

            # agent = torch.load(f'{path}/{type}/{file}')
        #     agent = [-0.189801320433616638183593750000, -0.019877597689628601074218750000,
        #  0.203804463148117065429687500000,  0.249169141054153442382812500000,
        # -0.377971082925796508789062500000, -0.293615400791168212890625000000,
        # -0.154077693819999694824218750000, -0.650006711483001708984375000000,
        # -0.014232054352760314941406250000, -0.569038093090057373046875000000,
        #  0.590094685554504394531250000000,  0.534781813621520996093750000000,
        # -0.985574841499328613281250000000]
        #     agent = [ 0.086211785674095153808593750000,  0.030274640768766403198242187500,
        #  0.044981919229030609130859375000, -0.026785632595419883728027343750,
        #  0.106257572770118713378906250000, -0.120059862732887268066406250000,
        # -0.051266204565763473510742187500,  0.066914945840835571289062500000,
        # -0.043786615133285522460937500000,  0.128087982535362243652343750000,
        #  0.021597413346171379089355468750, -0.035396471619606018066406250000,
        # -0.025467179715633392333984375000]
            agent = [-0.182583928108215332031250000000,  0.110460944473743438720703125000,
         0.121897131204605102539062500000, -0.143667042255401611328125000000,
        -0.228466570377349853515625000000,  0.251428484916687011718750000000,
         0.858810305595397949218750000000, -0.882503926753997802734375000000,
        -0.424084603786468505859375000000,  0.353877067565917968750000000000,
        -0.068101607263088226318359375000,  0.159483224153518676757812500000,
         0.619222521781921386718750000000]
            fitness = evaluate2(agent,
                                cpg_network_structure,
                                modified.select_morph([0, 0.0]), False)
            print(file, fitness)
            overall.append(fitness)

    sns.heatmap(np.array(overall).reshape(5, 6), vmin=0, vmax=4, cmap='rocket_r')
    plt.savefig(f'{path}/{file}.pdf')
    plt.show()

    df = pd.DataFrame(overall)
    df.to_csv(f'{path}_Default.csv')